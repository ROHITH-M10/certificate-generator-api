
# ğŸ† Certificate Generator â€“ Automated with Google Sheets + Flask Backend

This project automates certificate generation using:
- ğŸ“„ Google Sheets as frontend
- âš™ï¸ Google Apps Script as automation layer
- ğŸ§  Flask backend (PDF generation)
- â˜ï¸ Google Drive as storage

---

## âœ… Features

- Auto-generates a certificate when **â€œyesâ€** is entered in the **Approval** column.
- Sends data to a hosted **Flask backend** that returns a PDF.
- Uploads the PDF to a **Google Drive folder**.

---

## ğŸ“ Folder Structure (Your Local Setup)

```
certificate-generator/
â”œâ”€â”€ app.py                     # Flask backend
â”œâ”€â”€ certificate_template.pdf   # Your certificate template
â”œâ”€â”€ requirements.txt           # Flask, PyMuPDF
â””â”€â”€ README.md
```

---

## ğŸš€ 1. Set Up the Flask Backend

### Option A: Deploy on Render

1. Create a free Render account: https://dashboard.render.com
2. Click **"New Web Service"**
3. Connect your GitHub repo with the Flask backend.
4. In "Build Command", put:
   ```bash
   pip install -r requirements.txt
   ```
5. In "Start Command", put:
   ```bash
   python app.py
   ```
6. Set environment variable (optional):
   - `PORT` = `10000` (Render uses dynamic ports internally)
7. Deploy and note the generated URL  
   (e.g. `https://<URL>.onrender.com/generate`)

âœ… Done â€” your backend is now live.

---

## ğŸ§¾ 2. Prepare Google Sheet

Create a Google Sheet with 3 columns:

| Name | Roll No | Approval |
|------|---------|----------|
| John Doe | 123 | yes |

Whenever **â€œyesâ€** is typed in the **Approval** column, a certificate is generated.

---

## ğŸ› ï¸ 3. Set Up Google Apps Script

1. Go to your Google Sheet â†’ Extensions â†’ **Apps Script**
2. Paste the following code:

```javascript
function onEdit(e) {
  var sheet = e.source.getActiveSheet();
  var row = e.range.getRow();
  var col = e.range.getColumn();
  var approvalCol = 3; // Column C

  if (col === approvalCol) {
    var value = e.range.getValue().toString().toLowerCase().trim();
    if (value === 'yes') {
      var name = String(sheet.getRange(row, 1).getValue()).trim();
      var roll = String(sheet.getRange(row, 2).getValue()).trim();

      var payload = {
        name: name,
        roll: roll
      };

      var options = {
        method: 'post',
        contentType: 'application/json',
        payload: JSON.stringify(payload),
        muteHttpExceptions: true
      };

      try {
        var response = UrlFetchApp.fetch("https://your-render-url.onrender.com/generate", options); // change -> https://your-render-url
        var statusCode = response.getResponseCode();

        if (statusCode === 200) {
          var blob = response.getBlob();
          var folder = DriveApp.getFolderById("YOUR_FOLDER_ID"); //change -> YOUR_FOLDER_ID
          folder.createFile(blob).setName(`${roll}_${name}.pdf`);
          sheet.getRange(row, 4).setValue("âœ… Generated");
        } else {
          sheet.getRange(row, 4).setValue("âŒ Error");
        }
      } catch (err) {
        Logger.log("Error: " + err.message);
        sheet.getRange(row, 4).setValue("âŒ Exception");
      }
    }
  }
}
```

3. Replace:
   - `https://your-render-url...` with your actual deployed URL
   - `"YOUR_FOLDER_ID"` with your Drive folder ID (get it from the Drive URL)

---

## ğŸ”’ 4. Set Permissions (IMPORTANT)

1. Click the **clock icon â°** in the left Apps Script bar (Triggers).
2. Click **â€œAdd Triggerâ€**
   - Choose function: `onEdit`
   - Event type: **From spreadsheet**
   - Trigger type: **On edit**
3. Authorize permissions.

---

## ğŸ“„ 5. Certificate Template

Use **certificate_template.pdf** as your base.
Modify `NAME_POSITION` and `ROLL_POSITION` in `app.py` if needed.

```python
NAME_POSITION = (200, 300)
ROLL_POSITION = (200, 350)
```

---

## âœ… That's it!

Now, anytime someone sets **Approval = "yes"**, a certificate is:

1. Generated by the Flask server
2. Returned as a PDF
3. Uploaded into Google Drive automatically

---

## ğŸ§  Troubleshooting

- **"Specified permissions are not sufficient"**  
  â†’ You must set up the installable trigger and authorize it.
- **Nothing is uploaded to Drive**  
  â†’ Check logs in Apps Script and make sure folder ID is correct.
- **PDF not generating**  
  â†’ Confirm backend is reachable via Postman or curl.
